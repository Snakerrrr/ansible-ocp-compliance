apiVersion: policy.open-cluster-management.io/v1
kind: PolicyGenerator
metadata:
  name: compliance-operator-policies
  # Última actualización: {{ ansible_date_time.iso8601 }}

policyDefaults:
  namespace: policies
  remediationAction: {{ _scan_remediation_action | default('inform') }}
  placement:
    labelSelector:
      matchExpressions:
        - key: {{ placement_label_key | default('environment') }}
          operator: In
          values:
            - {{ placement_label_value | default('cluster-acs') }}

policies:
  - name: install-compliance-operator
    disabled: false
    remediationAction: {{ _install_operator_remediation_action | default('enforce') }}
    manifests:
      - path: compliance-operator/install

  - name: scan-setting-periodic
    remediationAction: {{ _scan_remediation_action }}
    disabled: false
    manifests:
      - path: compliance-operator/scan-setting

  - name: run-cis-scan
    remediationAction: {{ _scan_remediation_action }}
    disabled: {{ 'false' if run_cis else 'true' }}
    manifests:
      - path: compliance-operator/profiles/cis

  - name: run-pci-scan
    remediationAction: {{ _scan_remediation_action }}
    disabled: {{ 'false' if run_pci else 'true' }}
    manifests:
      - path: compliance-operator/profiles/pci

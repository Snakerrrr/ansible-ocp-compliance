- name: "[LOGS] Obtener ClusterLogForwarder"
  kubernetes.core.k8s_info:
    api_version: logging.openshift.io/v1
    kind: ClusterLogForwarder
    namespace: openshift-logging
    kubeconfig: "{{ dynamic_kubeconfig_path | default(omit) }}"
  register: clf_info
  environment:
    KUBECONFIG: "{{ dynamic_kubeconfig_path }}"

- name: "[LOGS] Procesar resultado"
  ansible.builtin.set_fact:
    clf_exists: "{{ clf_info.resources | length > 0 }}"

- name: "[LOGS] Validar AuditorÃ­a"
  ansible.builtin.set_fact:
    audit_configured: "{{ clf_info.resources[0].spec.inputs | default([]) | selectattr('type', 'equalto', 'audit') | list | length > 0 if clf_exists else false }}"

- name: "[LOGS] Definir texto resultado"
  ansible.builtin.set_fact:
    clf_resultado: >-
      {% if not clf_exists %}La instancia ClusterLogForwarder (CLF) NO EXISTE
      {% elif not audit_configured %}La instancia ClusterLogForwarder existe - Nombre: {{ clf_info.resources[0].metadata.name }} - SIN AUDIT LOGS
      {% else %}La instancia ClusterLogForwarder existe - Nombre: {{ clf_info.resources[0].metadata.name }} - CON AUDIT LOGS{% endif %}